# 递归

递归（recursion）在计算机科学中是指一种通过重复将问题分解为同类的子问题而解决问题的方法。

说简单的就是程序自己调用自己。

> 递归的强大指之处在于它允许用户用有限的语句描述无限的对象。因此，在计算机科学中，递归可以被用来描述无限步的运算，尽管描述运算的程序是有限的。 —— 尼克劳斯·维尔特

## 基线条件和递归条件

每个递归函数都有两部分：**基线条件(base case)**和**递归条件(recursive case)**

- 递归条件指的是函数调用自己
- 基线条件指的是函数不再调用自己（递归退出条件）

```python
def countdown(i):
  print(i)
  if i <= 0: # 基线条件
    return
  else:      # 递归条件
    countdown(i - 1)
```

## 栈

调用栈不仅对编程来说很重要，使用递归时也必须理解这个概念。

- 栈(stack)，是计算机科学中的一种抽象数据结构，只允许在有序的线性数据集合的一端（又称栈顶）进行加入数据和移除数据的运算。因而按照后进先出(LIFO)的原理运作。
- 计算机在内部使用被称为**调用栈**的栈。

场景：(为了简化，假设`print`不是函数)

```python
def greet(name):
  print('hello, ' + name + '!')
  greet2(name)
  print('getting ready to say bye...')
  bye()

def greet2(name):
  print('how are you, ' + name + '?')

def bye()
  print('ok bye!')
```

- 假设调用函数`greet('wangming')`，此时计算机会给该函数调用分配一块内存，并存储函数中的变量。
- 打印`hello, wangming!`
- 调用`greet2('xiaoming')`，同样，计算集会分配一块内存。函数`green('wangming')`暂停执行。
- 计算机会栈来表示这些内存，第一个内存块位于第一个上面。
- 打印`how are you, xiaoming?`，退出函数`greet2()`，并弹出栈顶内存块。函数`greet2()`执行结束，返回到`greet()`中继续执行。
- 打印`getting ready to say bye...`
- 调用函数`bye()`，并在栈顶添加函数`bye()`的内存块
- 打印`ok bye!`。并返回到`greet()`函数中。
- 退出`greet()`函数。

使用栈虽然方便，但是存储详尽的信息可能占用大量的内存。每个函数调用都要占用一定的内存，如果栈很高，就意味着计算机存储了大量函数调用的信息。这种情况有两种选择：

- 使用循环重新编写代码
- 使用尾递归

### 尾递归

在计算机科学中，**尾调用**是指一个函数李的最后一个动作是一个函数调用的情形：即这个调用的返回值直接被当前函数返回的情形。这种情形下称该调用位置为**尾位置**。

若这个函数在尾位置调用本身，则称这种情况为**尾递归**，是递归的一种特殊情形。

尾递归的判断标准是**函数运行最后一步是否调用自身，而不是是否在函数最后一个行调用自身。**

```python
# 尾递归
def f(x):
  if x == 1:
    return 1
  return f(x - 1)

# 不是尾递归，因为最后一步并不是直接返回函数的返回值，而是加上 1 再返回
def g(x):
  if x == 1:
    return 1
  return 1 + g(x - 1)
```

## 总结

- 递归指的是调用自己的函数
- 每个递归函数都有两个条件：基线条件和递归条件
- 栈有两种操作：压入和弹出
- 所有函数调用都进入调用栈
- 调用栈可能很长，这将占用大量内存
